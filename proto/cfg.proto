syntax = "proto3";

option go_package = "./pb";

package gserver;

// 刷新方式
enum RefreshType {
  RefreshType_None    = 0; // 解决"The first enum value must be zero in proto3."的报错
  RefreshType_Day     = 1; // 每日重置
}

// 时间类型
enum TimeType {
  TimeType_None       = 0;
  TimeType_Timestamp  = 1; // 时间戳
  TimeType_Date       = 2; // 日期(格式:20240219) 
}

// 物品类型
enum ItemType {
  ItemType_None 	= 0; // 普通物品
  ItemType_Equip  	= 1; // 装备
}

// 物品配置
message ItemCfg {
  int32 CfgId = 1;
  string Name = 2;
  string Detail = 3;
  int32 ItemType = 4; // 物品类型(enum ItemType)
  int32 TimeType = 5; // 时间类型(enum TimeType)
  int32 Timeout = 6; // 结束时间
}

// 添加元素参数
message AddElemArg {
	int32 CfgId = 1; // 配置id
	int32 Num = 2; // 数量
	int32 TimeType = 3; // 时间类型(enum TimeType)
	int32 Timeout = 4; // 结束时间
	int32 Source = 5; // 来源(一般用于数据分析)
	map<string,string> Properties = 6; // 扩展属性
	// NOTE: 有些项目有绑定属性,可以在这里加
}

// CfgId + Arg
message CfgArg {
  int32 CfgId = 1; // 配置id
  int32 Arg = 2; // 单个参数
}

// CfgId + Args
message CfgArgs {
  int32 CfgId = 1; // 配置id
  repeated int32 Args = 2; // 参数数组
}

// 时间类型
enum QuestType {
  QuestType_None		= 0;
  QuestType_SubQuest 	= 1; // 其他系统的子任务(如活动的子任务)
}

// 任务配置
message QuestCfg {
  int32 CfgId = 1;
  string Name = 2;
  int32 QuestType = 3; // 任务类型(enum QuestType)
  int32 RefreshType = 4; // 刷新机制(enum RefreshType)
  repeated AddElemArg Rewards = 5; // 任务奖励
  int32 PreQuest = 6; // 前置任务
  repeated int32 NextQuests = 7; // 完成该任务后,自动接后续的任务(任务链)
  map<string,string> Properties = 10; // 扩展属性
  int32 Category = 11; // 任务分类(可用于客户端分类显示 如主线任务 支线任务 成就等)
  string Detail = 12; // 任务描述

  repeated CfgArgs ConditionTemplates = 13; // 关联的配置模板id和参数,简化配置表用,业务代码不要调用
  CfgArg ProgressTemplate = 14; // 关联的配置模板id和参数,简化配置表用,业务代码不要调用
}

// 升级经验
message LevelExp {
	int32 Level = 1; // 等级
	int32 NeedExp = 2; // 升到该等级需要的经验值
}

// 数值比较配置
message ValueCompareCfg {
  string Op = 1;   // 操作符 = > >= < <= != [] ![]
  repeated int32 Values = 2; // 比较的值(可配多个)
}

// 进度模板配置
message ProgressTemplateCfg {
  int32 CfgId = 1; // 配置id
  int32 Type = 2; // 进度类型(enum ProgressType)
  bool NeedInit = 3; // 接任务时,是否初始化一下当前进度
  string Event = 4; // 关联的事件名
  string ProgressField = 5; // 以事件字段值作为进度值,为空表示进度值是1
  map<string,ValueCompareCfg> IntEventFields = 6; // 数值类型的事件字段值(支持复杂的比较操作符)
  map<string,string> StringEventFields = 7; // 事件字段值(字符串形式)
  map<string,string> Properties = 8; // 扩展属性
}